 * Serving Flask app 'app'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://172.31.87.57:5000
Press CTRL+C to quit
 * Serving Flask app 'app'
 * Debug mode: off
Address already in use
Port 5000 is in use by another program. Either identify and stop that program, or start the server with a different port.
 * Serving Flask app 'app'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://172.31.87.57:5000
Press CTRL+C to quit
 * Serving Flask app 'app'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://172.31.87.57:5000
Press CTRL+C to quit
177.78.0.190 - - [18/Oct/2025 02:31:14] "GET /health HTTP/1.1" 200 -
177.78.0.190 - - [18/Oct/2025 02:31:15] "GET /favicon.ico HTTP/1.1" 404 -
[2025-10-18 02:32:04,896] ERROR in app: Exception on /chat [POST]
Traceback (most recent call last):
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/home/ec2-user/Chat-Bot/app/routes/ai_route.py", line 23, in chat
    answer: dict = question_for_gemini(
  File "/home/ec2-user/Chat-Bot/app/service/service_ai.py", line 9, in question_for_gemini
    final_answer = models_management(id_user, id_session, question)
  File "/home/ec2-user/Chat-Bot/app/ai/ai_manager.py", line 14, in models_management
    embedding_files()
  File "/home/ec2-user/Chat-Bot/app/ai/ai_rag.py", line 43, in embedding_files
    if collection.count_documents({}) > 0:
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/collection.py", line 1913, in count_documents
    return self._retryable_non_cursor_read(_cmd, session)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/collection.py", line 1922, in _retryable_non_cursor_read
    with client._tmp_session(session) as s:
  File "/usr/lib64/python3.9/contextlib.py", line 119, in __enter__
    return next(self.gen)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1840, in _tmp_session
    s = self._ensure_session(session)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1823, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    self._topology._check_implicit_session_support()
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/topology.py", line 573, in _check_implicit_session_support
    self._check_session_support()
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/topology.py", line 589, in _check_session_support
    self._select_servers_loop(
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/topology.py", line 259, in _select_servers_loop
    raise ServerSelectionTimeoutError(
pymongo.errors.ServerSelectionTimeoutError: SSL handshake failed: ac-5abwycl-shard-00-02.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms),SSL handshake failed: ac-5abwycl-shard-00-01.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms),SSL handshake failed: ac-5abwycl-shard-00-00.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms), Timeout: 30s, Topology Description: <TopologyDescription id: 68f2f8bba04411fad63cc172, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ac-5abwycl-shard-00-00.pibm2oc.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('SSL handshake failed: ac-5abwycl-shard-00-00.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('ac-5abwycl-shard-00-01.pibm2oc.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('SSL handshake failed: ac-5abwycl-shard-00-01.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('ac-5abwycl-shard-00-02.pibm2oc.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('SSL handshake failed: ac-5abwycl-shard-00-02.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>
177.78.0.190 - - [18/Oct/2025 02:32:04] "POST /chat HTTP/1.1" 500 -
 * Serving Flask app 'app'
 * Debug mode: off
Address already in use
Port 5000 is in use by another program. Either identify and stop that program, or start the server with a different port.
[2025-10-18 02:43:32,236] ERROR in app: Exception on /chat [POST]
Traceback (most recent call last):
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/home/ec2-user/Chat-Bot/app/routes/ai_route.py", line 23, in chat
    answer: dict = question_for_gemini(
  File "/home/ec2-user/Chat-Bot/app/service/service_ai.py", line 9, in question_for_gemini
    final_answer = models_management(id_user, id_session, question)
  File "/home/ec2-user/Chat-Bot/app/ai/ai_manager.py", line 14, in models_management
    embedding_files()
  File "/home/ec2-user/Chat-Bot/app/ai/ai_rag.py", line 43, in embedding_files
    if collection.count_documents({}) > 0:
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/collection.py", line 1913, in count_documents
    return self._retryable_non_cursor_read(_cmd, session)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/collection.py", line 1922, in _retryable_non_cursor_read
    with client._tmp_session(session) as s:
  File "/usr/lib64/python3.9/contextlib.py", line 119, in __enter__
    return next(self.gen)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1840, in _tmp_session
    s = self._ensure_session(session)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1823, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    self._topology._check_implicit_session_support()
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/topology.py", line 573, in _check_implicit_session_support
    self._check_session_support()
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/topology.py", line 589, in _check_session_support
    self._select_servers_loop(
  File "/home/ec2-user/.local/lib/python3.9/site-packages/pymongo/topology.py", line 259, in _select_servers_loop
    raise ServerSelectionTimeoutError(
pymongo.errors.ServerSelectionTimeoutError: SSL handshake failed: ac-5abwycl-shard-00-02.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms),SSL handshake failed: ac-5abwycl-shard-00-01.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms),SSL handshake failed: ac-5abwycl-shard-00-00.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms), Timeout: 30s, Topology Description: <TopologyDescription id: 68f2f8bba04411fad63cc172, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('ac-5abwycl-shard-00-00.pibm2oc.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('SSL handshake failed: ac-5abwycl-shard-00-00.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('ac-5abwycl-shard-00-01.pibm2oc.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('SSL handshake failed: ac-5abwycl-shard-00-01.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('ac-5abwycl-shard-00-02.pibm2oc.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('SSL handshake failed: ac-5abwycl-shard-00-02.pibm2oc.mongodb.net:27017: [SSL: TLSV1_ALERT_INTERNAL_ERROR] tlsv1 alert internal error (_ssl.c:1147) (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>
177.78.0.190 - - [18/Oct/2025 02:43:32] "POST /chat HTTP/1.1" 500 -
 * Serving Flask app 'app'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://172.31.87.57:5000
Press CTRL+C to quit
[2025-10-18 02:45:18,418] ERROR in app: Exception on /chat [POST]
Traceback (most recent call last):
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/ec2-user/.local/lib/python3.9/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/home/ec2-user/Chat-Bot/app/routes/ai_route.py", line 23, in chat
    answer: dict = question_for_gemini(
  File "/home/ec2-user/Chat-Bot/app/service/service_ai.py", line 9, in question_for_gemini
    final_answer = models_management(id_user, id_session, question)
  File "/home/ec2-user/Chat-Bot/app/ai/ai_manager.py", line 14, in models_management
    embedding_files()
  File "/home/ec2-user/Chat-Bot/app/ai/ai_rag.py", line 56, in embedding_files
    embedding = gerar_embeddings([text])[0]
  File "/home/ec2-user/Chat-Bot/app/ai/ai_rag.py", line 26, in gerar_embeddings
    result = api_gemini.models.embed_content(
  File "/home/ec2-user/.local/lib/python3.9/site-packages/google/genai/models.py", line 3995, in embed_content
    response = self._api_client.request(
  File "/home/ec2-user/.local/lib/python3.9/site-packages/google/genai/_api_client.py", line 1306, in request
    response = self._request(http_request, http_options, stream=False)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/google/genai/_api_client.py", line 1142, in _request
    return self._retry(self._request_once, http_request, stream)  # type: ignore[no-any-return]
  File "/home/ec2-user/.local/lib/python3.9/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/tenacity/__init__.py", line 420, in exc_check
    raise retry_exc.reraise()
  File "/home/ec2-user/.local/lib/python3.9/site-packages/tenacity/__init__.py", line 187, in reraise
    raise self.last_attempt.result()
  File "/usr/lib64/python3.9/concurrent/futures/_base.py", line 439, in result
    return self.__get_result()
  File "/usr/lib64/python3.9/concurrent/futures/_base.py", line 391, in __get_result
    raise self._exception
  File "/home/ec2-user/.local/lib/python3.9/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/google/genai/_api_client.py", line 1119, in _request_once
    errors.APIError.raise_for_response(response)
  File "/home/ec2-user/.local/lib/python3.9/site-packages/google/genai/errors.py", line 108, in raise_for_response
    raise ClientError(status_code, response_json, response)
google.genai.errors.ClientError: 429 RESOURCE_EXHAUSTED. {'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.\n* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/embed_content_free_tier_requests', 'quotaId': 'EmbedContentRequestsPerMinutePerUserPerProjectPerModel-FreeTier'}]}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}]}}
177.78.0.190 - - [18/Oct/2025 02:45:18] "POST /chat HTTP/1.1" 500 -
 * Serving Flask app 'app'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://172.31.87.57:5000
Press CTRL+C to quit
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1760755793.209175    7677 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
E0000 00:00:1760755793.686952    7677 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
177.78.0.190 - - [18/Oct/2025 02:49:54] "POST /chat HTTP/1.1" 200 -
